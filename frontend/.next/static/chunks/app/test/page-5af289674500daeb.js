(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{43:function(e,t,r){Promise.resolve().then(r.bind(r,8895))},8895:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return l}});var a=r(7437),s=r(2265);function l(){let[e,t]=(0,s.useState)(""),[r,l]=(0,s.useState)(""),[n,o]=(0,s.useState)(""),[i,d]=(0,s.useState)(!1),[c,u]=(0,s.useState)(null),[g,b]=(0,s.useState)(!1),[h,x]=(0,s.useState)(""),[m,p]=(0,s.useState)([]),[y,k]=(0,s.useState)(null),[f,w]=(0,s.useState)(!1),[j,N]=(0,s.useState)(null),[v,C]=(0,s.useState)(!0);async function P(){try{let e=await fetch("/api/auth/session"),t=await e.json();t.authenticated&&(w(!0),N(t.user),_())}catch(e){console.error("Auth check failed:",e)}finally{C(!1)}}async function _(){try{let e=await fetch("/api/user/installations"),t=await e.json();t.success&&p(t.installations)}catch(e){console.error("Failed to fetch installations:",e)}}async function A(){if(!e){u("Please enter an API key");return}if(!e.startsWith("sk-ant-")){u('API key should start with "sk-ant-". Get your key from console.anthropic.com');return}let t=e.includes("-oat")?"oauth_token":"api_key";d(!0),u(null);try{let r=await fetch("/api/api-key/validate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:e,keyType:t})}),a=await r.json();a.valid?(b(!0),u(null)):u(a.error||"Invalid API key")}catch(e){u("Failed to validate API key")}finally{d(!1)}}async function S(){if(!r.trim()){u("Please enter a problem description");return}let t=e.includes("-oat")?"oauth_token":"api_key";if("oauth_token"===t){if(!h.trim()){u("Please enter a repository name (e.g., owner/repo)");return}d(!0),u(null),o("");try{let t=await fetch("/api/trigger-workflow",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:e,problemDescription:r,repoFullName:h})}),a=await t.json();a.success?o("\uD83D\uDE80 Issue Created & Webhook Triggered!\n\nIssue: ".concat(a.issueUrl,"\n\nWhat's happening now:\n1. ✅ OAuth token saved to database\n2. ✅ GitHub issue created with @claude mention\n3. ⏳ Webhook detected the mention\n4. ⏳ Worker.yml is running with Claude CLI\n5. ⏳ PR will be created automatically\n\nCheck your repo's Actions tab to see the workflow running!")):u(a.error||"Failed to create issue")}catch(e){u("Failed to create issue")}finally{d(!1)}return}d(!0),u(null),o("");try{let a=await fetch("/api/test-direct",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({apiKey:e,keyType:t,problemDescription:r})}),s=await a.json();s.success?o(s.response):u(s.error||"Test failed")}catch(e){u("Failed to test Claude")}finally{d(!1)}}return(0,s.useEffect)(()=>{P()},[]),v?(0,a.jsx)("main",{className:"flex min-h-screen items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300",children:"Checking authentication..."})]})}):f?(0,a.jsx)("main",{className:"flex min-h-screen items-center justify-center p-8",children:(0,a.jsxs)("div",{className:"max-w-2xl w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8",children:[j&&(0,a.jsxs)("div",{className:"flex items-center gap-3 mb-6 pb-6 border-b border-gray-200 dark:border-gray-700",children:[j.avatar_url&&(0,a.jsx)("img",{src:j.avatar_url,alt:j.login,className:"w-10 h-10 rounded-full"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"font-semibold text-gray-900 dark:text-white",children:j.login}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 dark:text-gray-400",children:[m.length," installation",1!==m.length?"s":""]})]})]}),(0,a.jsx)("h1",{className:"text-2xl font-bold mb-2 text-gray-900 dark:text-white text-center",children:"Test Claude Bot"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-6 text-center",children:"Test your Claude OAuth token and create PRs"}),g?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"mb-6 p-3 bg-green-50 dark:bg-green-900/20 border border-green-200 dark:border-green-800 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-green-600 dark:text-green-400",children:e.includes("-oat")?"OAuth token format is valid! This token will work with Claude Code CLI in GitHub workflows.":"API Key validated successfully!"})}),e.includes("-oat")?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-4 p-4 bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-blue-800 dark:text-blue-200 mb-2",children:"OAuth Token - Trigger Workflow"}),(0,a.jsx)("p",{className:"text-sm text-blue-700 dark:text-blue-300",children:"This will trigger the GitHub Actions workflow to create a PR using Claude CLI."})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"installation",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Select Repository"}),m.length>0?(0,a.jsxs)("select",{id:"installation",value:(null==y?void 0:y.account_login)||"",onChange:e=>{k(m.find(t=>t.account_login===e.target.value)||null),x(e.target.value?"".concat(e.target.value,"/").concat(e.target.value):"")},className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent",children:[(0,a.jsx)("option",{value:"",children:"Select an installation..."}),m.map(e=>(0,a.jsxs)("option",{value:e.account_login,children:[e.account_login," (",e.account_type,")"]},e.installation_id))]}):(0,a.jsxs)("div",{className:"p-4 bg-yellow-50 dark:bg-yellow-900/20 border border-yellow-200 dark:border-yellow-800 rounded-lg",children:[(0,a.jsx)("p",{className:"text-sm text-yellow-800 dark:text-yellow-200",children:"No installations found. Please install the GitHub App on a repository first."}),(0,a.jsx)("a",{href:"https://github.com/apps/YOUR_APP_NAME/installations/new",target:"_blank",rel:"noopener noreferrer",className:"mt-2 inline-block text-sm text-blue-600 dark:text-blue-400 underline",children:"Install GitHub App →"})]})]}),y&&(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"repoName",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Specific Repository (optional)"}),(0,a.jsx)("input",{type:"text",id:"repoName",value:h,onChange:e=>x(e.target.value),placeholder:"".concat(y.account_login,"/repo-name"),className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{htmlFor:"problem",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Problem Description"}),(0,a.jsx)("textarea",{id:"problem",value:r,onChange:e=>l(e.target.value),placeholder:"Describe what needs to be fixed or implemented...",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:4})]}),c&&(0,a.jsx)("div",{className:"mb-4 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:c})}),(0,a.jsx)("button",{onClick:S,disabled:i||!r.trim()||!h.trim(),className:"w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:i?"Creating Issue & Triggering PR...":"Create Issue & Trigger PR"}),n&&(0,a.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Result:"}),(0,a.jsx)("div",{className:"text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:n})]})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"problem",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"Problem Description"}),(0,a.jsx)("textarea",{id:"problem",value:r,onChange:e=>l(e.target.value),placeholder:"Describe a problem or bug you want Claude to help with...",className:"w-full px-4 py-3 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent resize-none",rows:4})]}),c&&(0,a.jsx)("div",{className:"mb-6 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:c})}),(0,a.jsx)("button",{onClick:S,disabled:i||!r.trim(),className:"w-full bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-purple-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:i?"Testing...":"Test Claude"}),n&&(0,a.jsxs)("div",{className:"mt-6 p-4 bg-gray-50 dark:bg-gray-700 rounded-lg",children:[(0,a.jsx)("h3",{className:"text-sm font-semibold text-gray-700 dark:text-gray-300 mb-2",children:"Claude's Response:"}),(0,a.jsx)("div",{className:"text-sm text-gray-800 dark:text-gray-200 whitespace-pre-wrap",children:n})]})]}),(0,a.jsx)("button",{onClick:()=>{b(!1),t(""),l(""),o(""),u(null)},className:"mt-4 w-full bg-gray-200 dark:bg-gray-700 text-gray-900 dark:text-white px-6 py-2 rounded-lg hover:bg-gray-300 dark:hover:bg-gray-600 transition-colors",children:"Use Different API Key"})]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"mb-6 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg",children:[(0,a.jsxs)("p",{className:"text-sm text-blue-800 dark:text-blue-200",children:[(0,a.jsx)("strong",{children:"Get your API key from:"})," ",(0,a.jsx)("a",{href:"https://console.anthropic.com/settings/keys",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"console.anthropic.com/settings/keys"})]}),(0,a.jsx)("p",{className:"text-xs text-blue-600 dark:text-blue-300 mt-2",children:"Supports both API keys (sk-ant-api...) and Claude Code OAuth tokens (sk-ant-oat...)"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{htmlFor:"apiKey",className:"block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2",children:"API Key or Token"}),(0,a.jsx)("input",{type:"password",id:"apiKey",value:e,onChange:e=>t(e.target.value),placeholder:"sk-ant-...",className:"w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-lg bg-white dark:bg-gray-700 text-gray-900 dark:text-white focus:ring-2 focus:ring-blue-500 focus:border-transparent"})]}),c&&(0,a.jsx)("div",{className:"mb-6 p-3 bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-red-600 dark:text-red-400",children:c})}),(0,a.jsx)("button",{onClick:A,disabled:i||!e,className:"w-full bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold hover:bg-blue-700 disabled:bg-gray-400 disabled:cursor-not-allowed transition-colors",children:i?"Validating...":"Validate API Key"})]}),(0,a.jsx)("p",{className:"mt-6 text-xs text-gray-500 dark:text-gray-400 text-center",children:"This is a test page. Your API key is sent directly to Anthropic and is not stored."})]})}):(0,a.jsx)("main",{className:"flex min-h-screen items-center justify-center p-8",children:(0,a.jsxs)("div",{className:"max-w-md w-full bg-white dark:bg-gray-800 rounded-lg shadow-lg p-8 text-center",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-4 text-gray-900 dark:text-white",children:"Test Claude Bot"}),(0,a.jsx)("p",{className:"text-gray-600 dark:text-gray-300 mb-6",children:"Sign in with GitHub to test Claude Bot with your repositories"}),(0,a.jsxs)("button",{onClick:function(){let e="".concat(window.location.origin,"/test");window.location.href="https://github.com/login/oauth/authorize?client_id=".concat("Iv23liSyuHGc6HElALhV","&redirect_uri=").concat(encodeURIComponent(e),"&scope=read:user")},className:"w-full bg-gray-900 dark:bg-white text-white dark:text-gray-900 px-6 py-3 rounded-lg font-semibold hover:bg-gray-700 dark:hover:bg-gray-200 transition-colors flex items-center justify-center gap-2",children:[(0,a.jsx)("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 24 24",children:(0,a.jsx)("path",{d:"M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"})}),"Sign in with GitHub"]})]})})}}},function(e){e.O(0,[971,117,744],function(){return e(e.s=43)}),_N_E=e.O()}]);