"use strict";(()=>{var e={};e.id=285,e.ids=[285,494],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},4770:e=>{e.exports=require("crypto")},4802:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>h,patchFetch:()=>k,requestAsyncStorage:()=>_,routeModule:()=>y,serverHooks:()=>g,staticGenerationAsyncStorage:()=>f});var r={};s.r(r),s.d(r,{GET:()=>d,POST:()=>p,dynamic:()=>l});var a=s(9303),n=s(8716),i=s(670),o=s(7070),u=s(5662),c=s(6494);let l="force-dynamic";async function p(e){try{let{installationId:t,apiKey:s,keyType:r}=await e.json();if(!t||!s)return o.NextResponse.json({success:!1,error:"Missing required fields"},{status:400});let a=e.cookies.get("github_user_id")?.value;if(!a)return o.NextResponse.json({success:!1,error:"Not authenticated"},{status:401});let n=(0,u.l)(),{data:i,error:l}=await n.from("installations").select("*, users:user_id(*)").eq("installation_id",t).single();if(l||!i)return o.NextResponse.json({success:!1,error:"Installation not found"},{status:404});if(i.users?.github_user_id!==parseInt(a)&&"User"===i.account_type)return o.NextResponse.json({success:!1,error:"You don't have access to this installation"},{status:403});let p=process.env.ENCRYPTION_KEY;if(!p)return console.error("ENCRYPTION_KEY not set"),o.NextResponse.json({success:!1,error:"Server configuration error"},{status:500});let{encrypted:d,iv:y,authTag:_}=(0,c.encrypt)(s,p),f=s.substring(0,15)+"...",g=i.user_id;if(!g){let{data:e}=await n.from("users").select("id").eq("github_user_id",parseInt(a)).single();(g=e?.id)&&await n.from("installations").update({user_id:g}).eq("installation_id",t)}let{error:h}=await n.from("api_keys").upsert({installation_id:parseInt(t),user_id:g,encrypted_key:d,key_iv:y,key_auth_tag:_,key_prefix:f,key_type:r||"api_key",key_status:"active",failure_count:0,last_validated_at:new Date().toISOString()},{onConflict:"installation_id"});if(h)return console.error("Error saving API key:",h),o.NextResponse.json({success:!1,error:"Failed to save API key"},{status:500});return o.NextResponse.json({success:!0})}catch(e){return console.error("Save API key error:",e),o.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function d(e){try{let t=e.nextUrl.searchParams.get("installation_id");if(!t)return o.NextResponse.json({success:!1,error:"Missing installation_id"},{status:400});if(!e.cookies.get("github_user_id")?.value)return o.NextResponse.json({success:!1,error:"Not authenticated"},{status:401});let s=(0,u.l)(),{data:r,error:a}=await s.from("api_keys").select("key_prefix, key_status, key_type, last_validated_at").eq("installation_id",t).single();if(a||!r)return o.NextResponse.json({success:!0,hasKey:!1});return o.NextResponse.json({success:!0,hasKey:!0,keyPrefix:r.key_prefix,keyStatus:r.key_status,keyType:r.key_type,lastValidated:r.last_validated_at})}catch(e){return console.error("Get API key status error:",e),o.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/api-key/route",pathname:"/api/api-key",filename:"route",bundlePath:"app/api/api-key/route"},resolvedPagePath:"/Users/muralivvrsngurajapu/claude-bot/frontend/app/api/api-key/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:_,staticGenerationAsyncStorage:f,serverHooks:g}=y,h="/api/api-key/route";function k(){return(0,i.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:f})}},6494:(e,t,s)=>{s.d(t,{encrypt:()=>o,p:()=>u});var r=s(4770),a=s.n(r);let n="aes-256-gcm",i="claude-bot-salt-v1";function o(e,t){let s=a().scryptSync(t,i,32),r=a().randomBytes(12),o=a().createCipheriv(n,s,r,{authTagLength:16}),u=o.update(e,"utf8","base64");u+=o.final("base64");let c=o.getAuthTag();return{encrypted:u,iv:r.toString("base64"),authTag:c.toString("base64")}}function u(e,t,s,r){let o=a().scryptSync(r,i,32),u=a().createDecipheriv(n,o,Buffer.from(t,"base64"),{authTagLength:16});return u.setAuthTag(Buffer.from(s,"base64")),u.update(e,"base64","utf8")+u.final("utf8")}},5662:(e,t,s)=>{s.d(t,{l:()=>a});var r=s(6596);function a(){return(0,r.eI)("https://riiisqzwbhlytogcjdmn.supabase.co",process.env.SUPABASE_SERVICE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,596],()=>s(4802));module.exports=r})();