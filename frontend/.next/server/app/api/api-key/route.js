"use strict";(()=>{var e={};e.id=285,e.ids=[285],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7158:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>v,patchFetch:()=>h,requestAsyncStorage:()=>f,routeModule:()=>y,serverHooks:()=>k,staticGenerationAsyncStorage:()=>g});var r={};s.r(r),s.d(r,{GET:()=>_,POST:()=>d,dynamic:()=>p});var a=s(9303),n=s(8716),i=s(670),o=s(7070),u=s(5662);let c=require("crypto");var l=s.n(c);let p="force-dynamic";async function d(e){try{let{installationId:t,apiKey:s,keyType:r}=await e.json();if(!t||!s)return o.NextResponse.json({success:!1,error:"Missing required fields"},{status:400});let a=e.cookies.get("github_user_id")?.value;if(!a)return o.NextResponse.json({success:!1,error:"Not authenticated"},{status:401});let n=(0,u.l)(),{data:i,error:c}=await n.from("installations").select("*, users:user_id(*)").eq("installation_id",t).single();if(c||!i)return o.NextResponse.json({success:!1,error:"Installation not found"},{status:404});if(i.users?.github_user_id!==parseInt(a)&&"User"===i.account_type)return o.NextResponse.json({success:!1,error:"You don't have access to this installation"},{status:403});let p=process.env.ENCRYPTION_KEY;if(!p)return console.error("ENCRYPTION_KEY not set"),o.NextResponse.json({success:!1,error:"Server configuration error"},{status:500});let{encrypted:d,iv:_,authTag:y}=function(e,t){let s=l().scryptSync(t,"claude-bot-salt-v1",32),r=l().randomBytes(12),a=l().createCipheriv("aes-256-gcm",s,r,{authTagLength:16}),n=a.update(e,"utf8","base64");n+=a.final("base64");let i=a.getAuthTag();return{encrypted:n,iv:r.toString("base64"),authTag:i.toString("base64")}}(s,p),f=s.substring(0,15)+"...",g=i.user_id;if(!g){let{data:e}=await n.from("users").select("id").eq("github_user_id",parseInt(a)).single();(g=e?.id)&&await n.from("installations").update({user_id:g}).eq("installation_id",t)}let{error:k}=await n.from("api_keys").upsert({installation_id:parseInt(t),user_id:g,encrypted_key:d,key_iv:_,key_auth_tag:y,key_prefix:f,key_type:r||"api_key",key_status:"active",failure_count:0,last_validated_at:new Date().toISOString()},{onConflict:"installation_id"});if(k)return console.error("Error saving API key:",k),o.NextResponse.json({success:!1,error:"Failed to save API key"},{status:500});return o.NextResponse.json({success:!0})}catch(e){return console.error("Save API key error:",e),o.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}async function _(e){try{let t=e.nextUrl.searchParams.get("installation_id");if(!t)return o.NextResponse.json({success:!1,error:"Missing installation_id"},{status:400});if(!e.cookies.get("github_user_id")?.value)return o.NextResponse.json({success:!1,error:"Not authenticated"},{status:401});let s=(0,u.l)(),{data:r,error:a}=await s.from("api_keys").select("key_prefix, key_status, key_type, last_validated_at").eq("installation_id",t).single();if(a||!r)return o.NextResponse.json({success:!0,hasKey:!1});return o.NextResponse.json({success:!0,hasKey:!0,keyPrefix:r.key_prefix,keyStatus:r.key_status,keyType:r.key_type,lastValidated:r.last_validated_at})}catch(e){return console.error("Get API key status error:",e),o.NextResponse.json({success:!1,error:"Internal server error"},{status:500})}}let y=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/api-key/route",pathname:"/api/api-key",filename:"route",bundlePath:"app/api/api-key/route"},resolvedPagePath:"/Users/muralivvrsngurajapu/claude-bot/frontend/app/api/api-key/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:f,staticGenerationAsyncStorage:g,serverHooks:k}=y,v="/api/api-key/route";function h(){return(0,i.patchFetch)({serverHooks:k,staticGenerationAsyncStorage:g})}},5662:(e,t,s)=>{s.d(t,{l:()=>a});var r=s(6596);function a(){return(0,r.eI)(process.env.NEXT_PUBLIC_SUPABASE_URL,process.env.SUPABASE_SERVICE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,596],()=>s(7158));module.exports=r})();