"use strict";(()=>{var e={};e.id=813,e.ids=[813],e.modules={399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},5323:(e,t,s)=>{s.r(t),s.d(t,{originalPathname:()=>_,patchFetch:()=>m,requestAsyncStorage:()=>d,routeModule:()=>p,serverHooks:()=>g,staticGenerationAsyncStorage:()=>h});var r={};s.r(r),s.d(r,{POST:()=>l,dynamic:()=>c});var a=s(9303),i=s(8716),o=s(670),n=s(7070),u=s(5662);let c="force-dynamic";async function l(e){try{let{code:t,installation_id:s}=await e.json();if(!t||!s)return n.NextResponse.json({success:!1,error:"Missing code or installation_id"},{status:400});let r=await fetch("https://github.com/login/oauth/access_token",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({client_id:process.env.GITHUB_APP_CLIENT_ID,client_secret:process.env.GITHUB_APP_CLIENT_SECRET,code:t})}),a=await r.json();if(a.error)return n.NextResponse.json({success:!1,error:a.error_description||a.error},{status:400});let i=a.access_token,o=await fetch("https://api.github.com/user",{headers:{Authorization:`Bearer ${i}`,Accept:"application/vnd.github+json"}}),c=await o.json();if(!c.id)return n.NextResponse.json({success:!1,error:"Failed to get user info"},{status:400});let l=(0,u.l)(),{data:p,error:d}=await l.from("installations").select("*, users:user_id(*)").eq("installation_id",s).single();if(d||!p)return n.NextResponse.json({success:!1,error:"Installation not found"},{status:404});if(p.users&&p.users.github_user_id!==c.id){if("Organization"!==p.account_type)return n.NextResponse.json({success:!1,error:"You don't own this installation"},{status:403});{let e=await fetch(`https://api.github.com/orgs/${p.account_login}/members/${c.login}`,{headers:{Authorization:`Bearer ${i}`,Accept:"application/vnd.github+json"}});if(204!==e.status)return n.NextResponse.json({success:!1,error:"You don't have access to this installation"},{status:403})}}let{data:h,error:g}=await l.from("users").upsert({github_user_id:c.id,github_username:c.login,email:c.email,avatar_url:c.avatar_url},{onConflict:"github_user_id"}).select().single();g&&console.error("Error upserting user:",g),!p.user_id&&h&&await l.from("installations").update({user_id:h.id}).eq("installation_id",s);let _=n.NextResponse.json({success:!0,user:{login:c.login,avatar_url:c.avatar_url,id:c.id}});return _.cookies.set("github_user_id",String(c.id),{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:86400}),_.cookies.set("github_username",c.login,{httpOnly:!0,secure:!0,sameSite:"lax",maxAge:86400}),_}catch(e){return console.error("OAuth callback error:",e),n.NextResponse.json({success:!1,error:"Authentication failed"},{status:500})}}let p=new a.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/auth/github/callback/route",pathname:"/api/auth/github/callback",filename:"route",bundlePath:"app/api/auth/github/callback/route"},resolvedPagePath:"/Users/muralivvrsngurajapu/claude-bot/frontend/app/api/auth/github/callback/route.ts",nextConfigOutput:"",userland:r}),{requestAsyncStorage:d,staticGenerationAsyncStorage:h,serverHooks:g}=p,_="/api/auth/github/callback/route";function m(){return(0,o.patchFetch)({serverHooks:g,staticGenerationAsyncStorage:h})}},5662:(e,t,s)=>{s.d(t,{l:()=>a});var r=s(6596);function a(){return(0,r.eI)("https://riiisqzwbhlytogcjdmn.supabase.co",process.env.SUPABASE_SERVICE_KEY,{auth:{autoRefreshToken:!1,persistSession:!1}})}}};var t=require("../../../../../webpack-runtime.js");t.C(e);var s=e=>t(t.s=e),r=t.X(0,[276,972,596],()=>s(5323));module.exports=r})();